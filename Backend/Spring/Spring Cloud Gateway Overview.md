# 1. API Gateway: "호텔의 프론트 데스크"

<img src="https://www.express-gateway.io/assets/img/api-gw-role.png" width="1200">  

- `Spring Cloude Gateway`를 공부하기 전에, 먼저 `API Gateway`라는 개념에 대해 알고 가야함
- 당신이 호텔을 이용하려는 손님이라고 가정

> - 호텔 손님(클라이언트)은 룸서비스, 청소 등의 다양한 서비스를 이용하고 싶다.
> - 하지만 각 서비스 담당자를 직접 찾아다니는 대신, <b>프론트 데스크(API Gateway)</b>에 요청한다.
> - 프론트 데스크는 손님의 요청을 받아 <b>적절한 서비스 부서로 전달</b>하고, <b>결과를 다시 손님에게 전달</b>한다.  

- `API Gateway`는 바로 이러한 프론트 데스크와 같은 역할을 수행
- 웹/모바일 앱이나 다른 서비스에서 오는 <b>모든 요청을 받아 적절한 내부 서비스로 라우팅</b>해줌

### ❓왜 API Gateway가 필요한가?

- 현대 애플리케이션에서는 <b>여러 개의 작은 서비스들이 함께 동작하고 있는 구조</b>를 띄고 있음 👉 [마이크로서비스 아키텍처(MSA)](https://wooaoe.tistory.com/57)  
- 예를 들어, 쇼핑몰 앱은 다음과 같은 서비스로 구성될 수 있음

> - 사용자 서비스 (로그인, 회원가입)
> - 상품 서비스 (상품 목록, 상세 정보)
> - 주문 서비스 (장바구니, 결제)
> - 배송 서비스 (배송 추적)  

- 이러한 구조에서는 다음과 같은 문제점들이 발생할 수 있음

> <b>❌발생하는 문제들</b>
> 1. 클라이언트 복잡성: 앱이 각 서비스에 직접 연결하면 매우 복잡해진다.
> 2. 인증 중복: 각 서비스마다 인증 로직을 구현해야 한다.
> 3. 다양한 프로토콜: 각 서비스마다 다른 통신 방식을 사용할 수도 있다.
> 4. 서비스 위치 변경: 서비스 주소가 변경되면, 모든 클라이언트를 업데이트해야 한다.  

- `API Gateway`는 이러한 문제를 해결할 수 있음

> <b>✅문제 해결</b>  
> 1. 모든 클라이언트의 요청을 단일 지점에서 받아서 처리한다.
> 2. 공통 기능(인증, 로깅 등)을 한 곳에서 처리한다.
> 3. 클라이언트는 여러 서비스 대신, 하나의 게이트웨이만 알면 된다. (서비스 위치를 변경해도 상관 X)

<br>

# 2. Spring Cloud Gateway란?

<img src="https://miro.medium.com/v2/resize:fit:1400/1*jvFNOwcOuLYQ7cKMWDyCCw.png" width="1200">  

- `Spring Cloude Gateway`는 Spring Framework에서 제공하는 API Gateway 솔루션
- Netflix Zuul과 같은 다른 게이트웨이도 있지만, `Spring Cloude Gateway`는 더 현대적이고 성능이 뛰어남
- <b>로드 밸런싱(Load Balacing)</b> 기능까지 탑재되어 있음!

### 주요 특징
> <b>1. 빠른 처리 능력</b>  
> - 비동기 & 논블로킹 방식으로 동시에 많은 요청을 처리할 수 있음
> - 마치, 카페에서 주문을 받은 직원이 다음 손님을 받으면서 동시에 바리스타에게 주문을 전달하는 것과 같음

> <b>2. 요청 라우팅</b>  
> - 들어온 요청을 어떤 서비스로 보낼지 결정
> - URL, 헤더, 쿼리 파라미터 등을 기준으로 라우팅 가능

> <b>3. 요청/응답 변환</b>  
> - 요청이나 응답을 필요에 따라 수정할 수 있음
> - ex. 헤더 추가, 경로 변경, 응답 내용 수정

> <b>4. 공통 기능 중앙화</b>  
> - 인증/인가 기능
> - 요청 제한 (특정 시간 내 요청 수 제한)
> - 로깅 및 모니터링  

### 핵심 구성 요소

1. <b>`Route(경로)`</b>
    - "이런 조건의 요청이 오면, 이 서비스로 보내라!"라는 규칙
    - ex. "/user"로 시작하는 URL은 사용자 서비스로 보내라!
2. <b>`Predicate(조건부)`</b>
    - 요청이 특정 조건에 맞는지 확인하는 규칙
    - ex. 경로가 특정 패턴인지, GET 요청인지, 특정 헤더가 있는지 등
3. <b>`Filter(필터)`</b>
    - 요청이나 응답을 수정하는 컴포넌트
    - ex. 인증 토큰 확인, 요청에 헤더 추가, 응답 데이터 변환 등  
